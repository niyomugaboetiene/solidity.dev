<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My token</title>
</head>
<body>
    <h2>Simple dApp</h2>
    <button onclick="connectWallet();">Connect Metamask</button>
    <p id="wallet">Wallet: not connected</p>
    <input type="text" id="address" placeholder="Enter address" />
    <button onclick="checkBalance();">Check balance</button>
    <p id="balance"></p>

<!-- ? load CND ethers.js library and my html directly interact with my CDN  -->

<script src="https://cdn.jsdelivr.net/npm/ethers@6.8.0/dist/ethers.umd.min.js"></script>
    <script>

        // it is like connection to the blockchain it read data from the blockchain like pure or view
        // blockchain connection
        let provider;
        // smart contract interface
        // it gives contract address contract ABI, 
        let contract;
        // wallet identity
        //  signer it is user's wallet identity (their private key but safely managed by MetaMask)
        // signer is needed when you want to write transaction like approve, balance
        let signer;

        // is your ethereum address where your contract is deployed
        // without this your frontend can not find your contract to check balance of send transaction
        const addressToken = "0xC86fa22a047B9aA61429B8d929f343FA5E6Cd24c";
        // ABI -> Application Binary Interface
        // is list of all functions, input, outputs, and event that your contract exposes it tells how to communicate with contract
        const tokenABI = [
            "function balanceOf(address) view returns(uint256)",
            "function decimals() view returns(uint8)"
        ];

        async function connectWallet() {
            // check if metaMask is installed if it is undefined means metaMask is not installed
            if (window.ethereum) {
                // read blockchain data
                provider = new ethers.BrowserProvider(window.ethereum);
                // represent specific ethereum account that can sign the transaction
                // is used to send transaction
                signer = await provider.getSigner();
                // retrieve ethereum address from the connected account 
                const userAddress = await signer.getAddress();

                document.getElementById("wallet").innerText = "Wallet: " + userAddress;

                // lets javascript frontend talks  to the deployed smart contract
                contract = new ethers.Contract(addressToken, tokenABI, provider);
                // console.log(await contract.balanceOf("0x72acEE3554A7456d47714E588C327ed86D445685"));

            } else {
                alert("Metamaks not found")
            }
        }


        async function checkBalance() {
            const address = document.getElementById("address").value;
            if (!address) return alert("Enter an address");

            const balance = await contract.balanceOf(address);
            const decimals = await contract.decimals();

            const readableBalance = ethers.formatUnits(balance, decimals);

            document.getElementById("balance").innerText = "Balance: " + readableBalance;
        }
    </script>
</body>
</html>